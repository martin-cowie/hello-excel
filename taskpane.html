<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸ‘‹ Hello Excel</title>
    <link rel="stylesheet" href="styles.css">

    <script type="text/javascript" src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
    <script src="https://unpkg.com/diffusion@6.9.5/dist/diffusion"></script>

</head>
<body>
    <h1>ðŸ‘‹ Hello Excel</h1>
    
    <img alt="Hello Excel" src="hello-excel.png">

    <div id="AUD:USD">...</div>
</body>

<script type="module">
    Office.onReady((info) => {
        console.log("Hello-Excel is ready.")

        diffusion.connect({
            host: 'ohost.eu.diffusion.cloud',
            principal: 'myuser',
            credentials: 'hunter2'
        }).then(function(session) {
            const topicPath = "my/fx/AUD:USD";
            console.log("Connected with session " + session.sessionId);
            session
                .addStream(topicPath, diffusion.datatypes.json())
                .on('value', function(topic, specification, newValue, oldValue) {
                    const topicValue = newValue.get()
                    console.log("Update for " + topic, topicValue);

                    document.getElementById('AUD:USD').innerHTML = topicValue;
                });

            // Subscribe to the topic
            session.select(topicPath);
        });
    });


</script>

</html>